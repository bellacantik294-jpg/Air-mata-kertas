<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin – Air Mata Kertas PRO</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>Admin</h1>

<section>
    <h2>Tambah Cerpen Baru</h2>

    <form id="adminForm">

        <label>Judul</label>
        <input type="text" id="adminTitle" required>

        <label>Kategori</label>
        <input type="text" id="adminCategory" placeholder="Romantis, Horor, dll">

        <label>Ringkasan</label>
        <input type="text" id="adminSummary" placeholder="Ringkasan singkat / prolog">

        <!-- ========== COVER UPLOAD ========== -->
        <label>Upload Cover Cerpen (Rasio 2:3)</label>
        <input type="file" id="adminCover" accept="image/*">

        <img id="adminCoverPreview"
             style="display:none; margin-top:10px; max-width:180px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.4);">
        <!-- ========== END COVER ============ -->

        <label>Isi Cerpen</label>
        <textarea id="adminContent" rows="10" required></textarea>

        <button type="submit">Simpan ke Penyimpanan Lokal</button>
    </form>
</section>

<hr>

<h2>Cerpen di LocalStorage</h2>
<div id="adminList"></div>

<p><a href="index.html">Kembali</a></p>

<script>
// =========================================================
//  COVER UPLOAD BASE64 HANDLER
// =========================================================
let coverBase64 = null;

document.getElementById("adminCover").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
        coverBase64 = e.target.result;
        const img = document.getElementById("adminCoverPreview");
        img.src = coverBase64;
        img.style.display = "block";
    };
    reader.readAsDataURL(file);
});


// =========================================================
//  SISTEM CERPEN (KOMPATIBEL DENGAN pro-script.js)
// =========================================================

const STORAGE_KEY = "amp_cerpen";

function getData() {
    try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    } catch (e) {
        return [];
    }
}

function saveData(arr) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(arr));
}

function renderList() {
    const data = getData();
    const list = document.getElementById("adminList");

    if (data.length === 0) {
        list.innerHTML = "<p>Belum ada cerpen.</p>";
        return;
    }

    list.innerHTML = data.map(c => `
        <div style="border:1px solid #ccc; padding:10px; margin-bottom:10px;">
            <strong>${c.title}</strong> – ${c.category}
            <br><small>${new Date(c.date).toLocaleString()}</small>
            <br>
            ${c.cover ? `<img src="${c.cover}" style="width:120px; border-radius:6px; margin-top:6px;">` : ""}
        </div>
    `).join("");
}

document.getElementById("adminForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const title = document.getElementById("adminTitle").value;
    const category = document.getElementById("adminCategory").value || "Tanpa kategori";
    const summary = document.getElementById("adminSummary").value || "";
    const content = document.getElementById("adminContent").value;

    const data = getData();

    const newCerpen = {
        id: "cerpen-" + Date.now(),
        title,
        category,
        excerpt: summary,
        content,
        date: new Date().toISOString(),
        cover: coverBase64 || "cover-sample.png"  // default jika user tidak upload
    };

    data.unshift(newCerpen);
    saveData(data);

    alert("Cerpen berhasil disimpan!");
    this.reset();
    coverBase64 = null;
    document.getElementById("adminCoverPreview").style.display = "none";

    renderList();
});


// Load list saat halaman dibuka
renderList();
</script>

</body>
</html>
